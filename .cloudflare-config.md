# Cloudflare Deployment Configuration

## ✅ API Token Verified

**Token Status:** Active and Valid  
**Account ID:** `8a96ac34caf00be04c7fa407efcefa85`  
**Token ID:** `cf546ae4539814801697d12fdc591a2b`  
**Verification Date:** 2025-11-18

## Token Details

```bash
# Test command to verify token
curl "https://api.cloudflare.com/client/v4/accounts/8a96ac34caf00be04c7fa407efcefa85/tokens/verify" \
  -H "Authorization: Bearer VTpUgPTAV18upz5VecWeqYEnObZOOPi9fd5ELFl-"
```

**Response:**

```json
{
  "result": {
    "id": "cf546ae4539814801697d12fdc591a2b",
    "status": "active"
  },
  "success": true,
  "errors": [],
  "messages": [
    {
      "code": 10000,
      "message": "This API Token is valid and active",
      "type": null
    }
  ]
}
```

## Environment Variable Setup

Add the following to your environment variables:

### Local Development (.env.local)

```bash
CLOUDFLARE_API_TOKEN=VTpUgPTAV18upz5VecWeqYEnObZOOPi9fd5ELFl-
CLOUDFLARE_ACCOUNT_ID=8a96ac34caf00be04c7fa407efcefa85
```

### Vercel Environment Variables

```bash
# Add to Vercel via CLI or dashboard
vercel env add CLOUDFLARE_API_TOKEN production
# When prompted, enter: VTpUgPTAV18upz5VecWeqYEnObZOOPi9fd5ELFl-

vercel env add CLOUDFLARE_ACCOUNT_ID production
# When prompted, enter: 8a96ac34caf00be04c7fa407efcefa85
```

### GitHub Actions (if using CI/CD)

```yaml
# Add to GitHub Secrets:
# Settings → Secrets and variables → Actions → New repository secret

CLOUDFLARE_API_TOKEN: VTpUgPTAV18upz5VecWeqYEnObZOOPi9fd5ELFl-
CLOUDFLARE_ACCOUNT_ID: 8a96ac34caf00be04c7fa407efcefa85
```

## Security Best Practices

1. ✅ **Never commit tokens to Git** - Always use environment variables
2. ✅ **Token is active** - Verified on 2025-11-18
3. ⚠️ **Rotate regularly** - Update token every 90 days
4. ⚠️ **Limit permissions** - Only grant necessary scopes
5. ⚠️ **Monitor usage** - Check Cloudflare dashboard for suspicious activity

## Cloudflare Deployment Options

### Option 1: Vercel + Cloudflare CDN (Recommended)

- Deploy to Vercel (already configured)
- Point DNS to Vercel through Cloudflare
- Cloudflare provides CDN and DDoS protection
- **Cost:** Free (Cloudflare) + $20/month (Vercel Pro)

### Option 2: Cloudflare Pages

- Direct deployment to Cloudflare Pages
- Unlimited bandwidth and requests
- Global CDN
- **Cost:** Free

### Option 3: Cloudflare Workers

- Serverless functions on Cloudflare edge
- Ultra-low latency
- **Cost:** Free tier (100k requests/day)

## Current Setup Status

- ✅ Cloudflare API token verified
- ✅ Build errors fixed (TypeScript issue in social page)
- ✅ Next.js build successful
- ✅ Cloudflare setup guide available (`cloudflare-setup.md`)
- ⏳ DNS configuration (follow `cloudflare-setup.md`)
- ⏳ Production deployment

## Next Steps

1. **Complete DNS Setup**
   - Follow instructions in `cloudflare-setup.md`
   - Add domain to Cloudflare
   - Update nameservers
   - Configure DNS records

2. **Deploy to Production**

   ```bash
   # Deploy to Vercel
   vercel --prod

   # Or deploy to Cloudflare Pages
   npm run build
   npx wrangler pages publish .next/static --project-name=istani
   ```

3. **Configure CDN**
   - Enable caching rules
   - Set up page rules
   - Configure security settings

4. **Test Deployment**

   ```bash
   # Test main site
   curl -I https://istani.org

   # Test API health
   curl https://istani.org/api/health

   # Test SSL
   curl -I https://istani.org | grep -i "x-"
   ```

## Cloudflare API Usage Examples

### Purge Cache

```bash
curl -X POST "https://api.cloudflare.com/client/v4/zones/YOUR_ZONE_ID/purge_cache" \
  -H "Authorization: Bearer VTpUgPTAV18upz5VecWeqYEnObZOOPi9fd5ELFl-" \
  -H "Content-Type: application/json" \
  --data '{"purge_everything":true}'
```

### Update DNS Record

```bash
curl -X PUT "https://api.cloudflare.com/client/v4/zones/YOUR_ZONE_ID/dns_records/RECORD_ID" \
  -H "Authorization: Bearer VTpUgPTAV18upz5VecWeqYEnObZOOPi9fd5ELFl-" \
  -H "Content-Type: application/json" \
  --data '{"type":"A","name":"@","content":"76.76.21.21","proxied":true}'
```

### Get Zone Info

```bash
curl "https://api.cloudflare.com/client/v4/zones" \
  -H "Authorization: Bearer VTpUgPTAV18upz5VecWeqYEnObZOOPi9fd5ELFl-"
```

## Troubleshooting

### Token Not Working

1. Verify token is active (use test command above)
2. Check token permissions in Cloudflare dashboard
3. Ensure correct account ID is used
4. Regenerate token if necessary

### Build Failures

1. Check `npm run build` completes successfully
2. Verify all environment variables are set
3. Review build logs for errors
4. Clear cache: `rm -rf .next node_modules && npm install`

### DNS Issues

1. Verify nameservers updated at registrar
2. Check DNS propagation: https://dnschecker.org
3. Wait up to 24-48 hours for full propagation
4. Test with: `dig istani.org` or `nslookup istani.org`

## Support Resources

- **Cloudflare Docs:** https://developers.cloudflare.com
- **Community:** https://community.cloudflare.com
- **Status Page:** https://www.cloudflarestatus.com
- **API Docs:** https://api.cloudflare.com

---

**Last Updated:** 2025-11-18  
**Status:** ✅ Token Verified, Build Fixed, Ready for Deployment
